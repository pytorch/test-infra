name: Test mobile workflow

on:
  pull_request:
    paths:
      - .github/workflows/mobile_job.yml
      - .github/workflows/test_mobile_job.yml
      - tools/device-farm-runner/**
  workflow_dispatch:

jobs:
  test-ios-job:
    permissions:
      id-token: write
      contents: read
    uses: ./.github/workflows/mobile_job.yml
    with:
      device-type: ios
      # For iOS testing, the runner just needs to call AWS Device Farm, so there is no need to run this on macOS
      runner: linux.2xlarge
      project-arn: arn:aws:devicefarm:us-west-2:308535385114:project:02a2cf0f-6d9b-45ee-ba1a-a086587469e6
      ios-ipa-archive: https://ossci-assets.s3.amazonaws.com/DeviceFarm.ipa
      ios-xctestrun-zip: https://ossci-assets.s3.amazonaws.com/MobileNetClassifierTest_MobileNetClassifierTest_iphoneos17.4-arm64.xctestrun.zip
      test-spec: https://ossci-assets.s3.amazonaws.com/default-ios-device-farm-appium-test-spec.yml

  test-android-llama2-job:
    permissions:
      id-token: write
      contents: read
    uses: ./.github/workflows/mobile_job.yml
    with:
      device-type: android
      runner: linux.2xlarge
      # There values are prepared beforehand for the test
      project-arn: arn:aws:devicefarm:us-west-2:308535385114:project:02a2cf0f-6d9b-45ee-ba1a-a086587469e6
      device-pool-arn: arn:aws:devicefarm:us-west-2:308535385114:devicepool:02a2cf0f-6d9b-45ee-ba1a-a086587469e6/e59f866a-30aa-4aa1-87b7-4510e5820dfa
      android-app-archive: https://ossci-assets.s3.amazonaws.com/app-debug.apk
      android-test-archive: https://ossci-assets.s3.amazonaws.com/app-debug-androidTest.apk
      test-spec: https://ossci-assets.s3.amazonaws.com/android-llama2-device-farm-test-spec.yml
      extra-data: https://ossci-assets.s3.amazonaws.com/executorch-android-llama2-7b.zip
