name: Setup uv
description: |
  Wrapper around astral-sh/setup-uv with a pinned version to avoid GitHub API
  rate limits. When uv.toml specifies a version range, setup-uv calls the
  GitHub API to resolve to a specific version. At PyTorch's CI scale, this
  exhausts rate limits. Pinning an explicit version avoids API calls entirely.

inputs:
  python-version:
    description: "The version of Python to set UV_PYTHON to"
    required: false
  activate-environment:
    description: "Use uv venv to activate a venv ready to be used by later steps."
    default: "false"
  ignore-empty-workdir:
    description: "Ignore when the working directory is empty."
    default: "false"
  enable-cache:
    description: "Enable uploading of the uv cache"
    default: "false"
  github-token:
    description: "Used to increase the rate limit when retrieving versions and downloading uv."
    required: false
    default: ${{ github.token }}

outputs:
  uv-version:
    description: "The installed uv version."
    value: ${{ steps.setup-uv.outputs.uv-version }}
  uv-path:
    description: "The path to the installed uv binary."
    value: ${{ steps.setup-uv.outputs.uv-path }}
  uvx-path:
    description: "The path to the installed uvx binary."
    value: ${{ steps.setup-uv.outputs.uvx-path }}

runs:
  using: composite
  steps:
    - name: Setup uv
      id: setup-uv
      uses: astral-sh/setup-uv@61cb8a9741eeb8a550a1b8544337180c0fc8476b # v7.2.0
      with:
        version: "0.9.21"
        python-version: ${{ inputs.python-version }}
        activate-environment: ${{ inputs.activate-environment }}
        ignore-empty-workdir: ${{ inputs.ignore-empty-workdir }}
        enable-cache: ${{ inputs.enable-cache }}
        github-token: ${{ inputs.github-token }}
