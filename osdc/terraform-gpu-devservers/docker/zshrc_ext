# GPU Dev Server Extensions (managed by system - do not edit)
# This file is overwritten on every pod startup to ensure latest features.
# Put your personal customizations in ~/.zshrc instead.

# User identification (set by Lambda on startup)
export GPU_DEV_USER_ID="dev"

# Function to check for GPU reservation expiry warnings and startup script status
check_warnings() {
    # Check for startup script still running
    if [[ -f /home/dev/STARTUP_SCRIPT_RUNNING.txt ]]; then
        echo -e "\033[1;33m$(cat /home/dev/STARTUP_SCRIPT_RUNNING.txt)\033[0m"
    fi
    # Check for expiry warnings
    setopt NULL_GLOB 2>/dev/null
    local warning_files=(/home/dev/WARN_EXPIRES_IN_*MIN.txt)
    if [[ ${#warning_files[@]} -gt 0 ]] && [[ -f "${warning_files[1]}" ]]; then
        # Extract minutes from filename (e.g., WARN_EXPIRES_IN_15MIN.txt -> 15)
        local minutes="${warning_files[1]:t:r}"  # Get basename without extension
        minutes="${minutes#WARN_EXPIRES_IN_}"    # Remove prefix
        minutes="${minutes%MIN}"                 # Remove suffix
        echo -e "\033[1;31mðŸš¨ URGENT: Server expires in <${minutes} minutes! ðŸš¨\033[0m"
    fi
}

# Run warning check before every command prompt (zsh hook)
precmd() { check_warnings }
